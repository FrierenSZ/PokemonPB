{% extends 'base.html' %}

{% block body_class %}pokedex-page{% endblock %}

{% block title %}Pokédex{% endblock %}

{% block content %}

<div class="pokedex-container">
    <a href="{{ url_for('index') }}" class="btn-back-home">← Voltar</a>
    <div class="pokedex-header">
        <h1>Pokédex</h1>
        <div></div>
    </div>

    <p class="pokedex-info">Mostrando {{ pokemons|length }} de {{ total }} Pokémons (Página {{ page }} de {{ total_pages
        }})</p>

    <div class="search-bar-wrapper">
        <input type="text" id="pokemon-search" placeholder="Pesquisar Pokémon (nome ou #id)...">
        <button id="search-btn">Buscar</button>
    </div>

    <div class="pokemon-grid-large">
        {% for pokemon in pokemons %}
        <div class="pokemon-card-large" data-url="{{ url_for('pokemon_detail', name_or_id=pokemon.name) }}">
            <div class="pokemon-artwork">
                <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/{{ pokemon.url.split('/')[-2] }}.png"
                    alt="{{ pokemon.name }}" loading="lazy">
            </div>
            <div class="pokemon-info">
                <span class="pokemon-id">#{{ pokemon.url.split('/')[-2] }}</span>
                <h3>{{ pokemon.name|capitalize }}</h3>
            </div>
        </div>
        {% endfor %}
    </div>

    <div class="pagination full-pages">
        
        {% if page > 1 %}
        <a href="{{ url_for('pokedex', page=page-1) }}" class="page-btn-arrow">← Anterior</a>
        {% endif %}

        {% set pages_to_show = 5 %}
        {% set start_page = (page - pages_to_show // 2)|max(1) %}
        {% set end_page = (start_page + pages_to_show - 1)|min(total_pages) %}
        
        {% if start_page > 1 %}
            <a href="{{ url_for('pokedex', page=1) }}" class="page-num">1</a>
            {% if start_page > 2 %}
                <span class="page-dots">...</span>
            {% endif %}
        {% endif %}

        {% for p in range(start_page, end_page + 1) %}
            {% if p == page %}
                <span class="page-num current">{{ p }}</span>
            {% else %}
                <a href="{{ url_for('pokedex', page=p) }}" class="page-num">{{ p }}</a>
            {% endif %}
        {% endfor %}

        {% if end_page < total_pages %}
            {% if end_page < total_pages - 1 %}
                <span class="page-dots">...</span>
            {% endif %}
            <a href="{{ url_for('pokedex', page=total_pages) }}" class="page-num">{{ total_pages }}</a>
        {% endif %}

        {% if page < total_pages %}
            <a href="{{ url_for('pokedex', page=page+1) }}" class="page-btn-arrow">Próxima →</a>
        {% endif %}

    </div>
</div>

<script>
    document.querySelectorAll('.pokemon-card-large').forEach(card => {
        card.addEventListener('click', () => {
            window.location.href = card.dataset.url;
        });
    });

  
    document.getElementById('search-btn').addEventListener('click', handleSearch);
    document.getElementById('pokemon-search').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            handleSearch();
        }
    });

    function handleSearch() {
        const input = document.getElementById('pokemon-search').value.toLowerCase().trim();
        if (input) {
            window.location.href = `/pokemon/${input}`;
        }
    }
</script>
{% endblock %}